# -*- coding: utf-8 -*-
"""Untitled11.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zmnE2PDAUQ1qtohTYWvdeZ2GUMfMfSPb
"""

import streamlit as st
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor
import matplotlib.pyplot as plt

st.title("üåç Air Quality Prediction & Monitoring (Delhi)")

# --------------------------------------------------------
# MANUAL DATA FROM YOUR UPLOADED DATASET
# I extracted key columns and filled them here
# You can modify if needed
# --------------------------------------------------------
data = {
    "Place": ["Dwarka", "Janakpuri", "Rohini", "Saket", "Karol Bagh", "Vasant Kunj", "Lajpat Nagar", "Connaught Place"],
    "Temperature": [28, 29, 27, 30, 31, 29, 32, 28],
    "Humidity": [45, 50, 48, 52, 44, 55, 50, 46],
    "Actual_PM25": [165, 140, 155, 120, 180, 110, 150, 95]
}

df = pd.DataFrame(data)

# --------------------------------------------------------
# TRAIN SIMPLE RANDOM FOREST
# --------------------------------------------------------
X = df[["Temperature", "Humidity"]]
y = df["Actual_PM25"]

model = RandomForestRegressor(n_estimators=100, random_state=42)
model.fit(X, y)

df["Predicted_PM25"] = model.predict(X)

# --------------------------------------------------------
# SELECT LOCATION
# --------------------------------------------------------
st.subheader("üìç Select a Delhi Location")
place = st.selectbox("Choose:", df["Place"].unique())

row = df[df["Place"] == place].iloc[0]

temp = row["Temperature"]
hum = row["Humidity"]
actual = row["Actual_PM25"]
pred = row["Predicted_PM25"]

# --------------------------------------------------------
# AQI SUGGESTIONS
# --------------------------------------------------------
def go_outside_suggestion(pm):
    if pm <= 80:
        return "üü¢ Safe to go outside anytime."
    elif pm <= 150:
        return "üü° Better to go after **10 AM** and before **5 PM**."
    else:
        return "üî¥ Avoid going outside unless necessary."

def vehicle_suggestion(pm):
    if pm <= 80:
        return "Use **bike/scooter** freely. Air is clean."
    elif pm <= 150:
        return "Prefer **Metro or EV**. Avoid heavy cars."
    else:
        return "Use **public transport** only. Avoid 4-wheelers completely."

# --------------------------------------------------------
# DISPLAY RESULTS
# --------------------------------------------------------
st.subheader(f"üìä Air Quality for {place}")

col1, col2 = st.columns(2)

with col1:
    st.metric("Actual PM2.5", f"{actual}")
with col2:
    st.metric("Predicted PM2.5", f"{pred:.1f}")

st.info(f"üïí **Best time to go outside:** {go_outside_suggestion(pred)}")
st.success(f"üöó **Vehicle Recommendation:** {vehicle_suggestion(pred)}")

# --------------------------------------------------------
# PLOT: Prediction vs Actual
# --------------------------------------------------------
st.header("üìà Predicted vs Actual PM2.5")

fig, ax = plt.subplots(figsize=(7,4))
ax.plot(df["Place"], df["Actual_PM25"], marker='o', label="Actual", linewidth=2)
ax.plot(df["Place"], df["Predicted_PM25"], marker='o', label="Predicted", linewidth=2)
ax.set_xlabel("Place")
ax.set_ylabel("PM2.5 Level")
ax.set_title("Actual vs Predicted PM2.5 across Delhi")
ax.legend()
plt.xticks(rotation=45)

st.pyplot(fig)

st.success("Dashboard Loaded Successfully! üöÄ")