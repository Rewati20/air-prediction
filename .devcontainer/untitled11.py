# -*- coding: utf-8 -*-
"""Untitled11.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zmnE2PDAUQ1qtohTYWvdeZ2GUMfMfSPb
"""

import streamlit as st
import pandas as pd
import numpy as np
import folium
from streamlit_folium import st_folium
from sklearn.ensemble import RandomForestRegressor
import matplotlib.pyplot as plt
import seaborn as sns

# ---------------------------------------------------------------------
# PRELOADED SAMPLE DATA (DELHI AREA) ‚Äî YOU ASKED TO FILL VALUES MANUALLY
# ---------------------------------------------------------------------
df = pd.DataFrame({
    "place": ["Connaught Place", "Chanakyapuri", "Dwarka", "Rohini", "Saket"],
    "lat": [28.6328, 28.5951, 28.5921, 28.7499, 28.5245],
    "lon": [77.2197, 77.1622, 77.0390, 77.0565, 77.2066],
    "temperature": [28, 27, 30, 29, 31],
    "humidity": [45, 48, 50, 44, 52],
    "pm25_actual": [160, 120, 180, 150, 95],
})

# Generate synthetic predicted values for model demonstration
df["pm25_predicted"] = df["pm25_actual"] + np.random.randint(-15, 15, size=len(df))

# ---------------------------------------------------------------------
# SIMPLE DELHI RANDOM FOREST MODEL (demonstration purpose)
# ---------------------------------------------------------------------
model = RandomForestRegressor(n_estimators=20, random_state=42)

X = df[["temperature", "humidity"]]
y = df["pm25_actual"]
model.fit(X, y)

# ---------------------------------------------------------------------
# STREAMLIT APP
# ---------------------------------------------------------------------
st.title("üåç Delhi Air Quality Prediction & Environment Monitoring Dashboard")

st.subheader("üìå Select a Location in Delhi")
place = st.selectbox("Choose Location:", df["place"].unique())

selected_row = df[df["place"] == place].iloc[0]

temp = selected_row["temperature"]
hum = selected_row["humidity"]
actual = selected_row["pm25_actual"]
pred = model.predict([[temp, hum]])[0]

# ---------------------------------------------------------------------
# WOW FACTOR 1 ‚Üí Smart Vehicle Recommendation
# ---------------------------------------------------------------------
def vehicle_recommendation(pm):
    if pm < 80:
        return "üü¢ Air is safe! You can use **bike, scooter, or walk**."
    elif pm < 150:
        return "üü° Moderate pollution. Prefer **public transport or EV**."
    else:
        return "üî¥ High pollution! Avoid 4-wheelers. Prefer **2-wheelers or Metro**."

# ---------------------------------------------------------------------
# WOW FACTOR 2 ‚Üí Smart School Timetable Suggestion
# ---------------------------------------------------------------------
def suggest_school_timing(pm):
    if pm < 80:
        return "üü¢ Schools can operate normally (8 AM ‚Äì 2 PM)."
    elif pm < 150:
        return "üü° Recommended shift: **10 AM ‚Äì 3 PM** (avoid morning smog)."
    else:
        return "üî¥ High AQI! Suggest **online classes until conditions improve**."

# ---------------------------------------------------------------------
# DISPLAY RESULTS
# ---------------------------------------------------------------------
st.header("üìä Prediction Summary")
st.write(f"### üìç Location: **{place}**")
st.write(f"üå° Temperature: **{temp}¬∞C**")
st.write(f"üíß Humidity: **{hum}%**")

col1, col2 = st.columns(2)
with col1:
    st.metric("Actual PM2.5", f"{actual}")
with col2:
    st.metric("Predicted PM2.5", f"{pred:.1f}")

st.success(vehicle_recommendation(pred))
st.info(suggest_school_timing(pred))

# ---------------------------------------------------------------------
# HEATMAP ‚Üí Pollution Levels Across Delhi
# ---------------------------------------------------------------------
st.header("üî• Heatmap of PM2.5 Levels Across Delhi")

m = folium.Map(location=[28.61, 77.20], zoom_start=11)

for i, row in df.iterrows():
    folium.Circle(
        radius=row["pm25_predicted"] * 5,
        location=[row["lat"], row["lon"]],
        popup=f"{row['place']} ‚Äî PM2.5: {row['pm25_predicted']}",
        color="red" if row["pm25_predicted"] > 150 else "orange",
        fill=True
    ).add_to(m)

st_folium(m, width=700, height=450)

# ---------------------------------------------------------------------
# Prediction vs Actual Graph
# ---------------------------------------------------------------------
st.header("üìà Actual vs Predicted PM2.5")

fig, ax = plt.subplots(figsize=(8,5))
ax.plot(df["place"], df["pm25_actual"], marker='o', label="Actual")
ax.plot(df["place"], df["pm25_predicted"], marker='o', label="Predicted")
ax.set_ylabel("PM2.5 Level")
ax.set_title("Actual vs Predicted PM2.5 Levels in Delhi")
ax.legend()
st.pyplot(fig)

# ---------------------------------------------------------------------
# Temperature vs Humidity Heatmap
# ---------------------------------------------------------------------
st.header("üå° Temperature vs Humidity Heatmap")

pivot = df.pivot_table(values="pm25_actual", index="place")
sns.heatmap(pivot, annot=True, cmap="Reds")
st.pyplot()

# ---------------------------------------------------------------------
# END
# ---------------------------------------------------------------------
st.success("Dashboard loaded successfully! Explore the features above.")