# -*- coding: utf-8 -*-
"""Untitled11.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zmnE2PDAUQ1qtohTYWvdeZ2GUMfMfSPb
"""

import streamlit as st
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor
import matplotlib.pyplot as plt

st.set_page_config(page_title="Delhi Air Quality Predictor", layout="wide")

st.title("üåç Delhi Air Quality Prediction & Monitoring System")
st.write("Select any Delhi area to view AQI prediction, health alerts, and movement recommendations.")

# -------------------------------------------------------------
# ‚úî MANUAL DATA (EXTRACTED FROM YOUR final_converted.csv)
# -------------------------------------------------------------
data = {
    "Place": [
        "Dwarka", "Janakpuri", "Rohini", "Saket", "Karol Bagh",
        "Vasant Kunj", "Lajpat Nagar", "Connaught Place", "Mayur Vihar", "Chanakyapuri"
    ],
    "Temperature": [28, 29, 27, 30, 31, 29, 32, 28, 30, 27],
    "Humidity": [45, 50, 48, 52, 44, 55, 50, 46, 53, 49],
    "WindSpeed": [4.1, 3.5, 2.9, 5.0, 3.2, 4.8, 3.1, 4.0, 3.6, 2.8],

    "PM2.5": [165, 140, 155, 120, 180, 110, 150, 95, 160, 145],
    "PM10":  [250, 210, 230, 190, 280, 170, 240, 150, 260, 225],
    "NO2":   [68, 55, 60, 48, 75, 44, 58, 40, 63, 59],
    "SO2":   [22, 18, 20, 15, 27, 14, 19, 12, 23, 21],
    "CO":    [1.2, 1.0, 1.1, 0.9, 1.3, 0.8, 1.0, 0.7, 1.2, 1.1],
    "O3":    [32, 28, 30, 25, 34, 26, 29, 24, 33, 31]
}

df = pd.DataFrame(data)

# AQI Calculation
df["AQI"] = (
    0.45 * df["PM2.5"] +
    0.25 * df["PM10"] +
    0.10 * df["NO2"] +
    0.10 * df["SO2"] +
    0.05 * df["CO"] * 100 +
    0.05 * df["O3"]
)

# -------------------------------------------------------------
# ‚úî TRAIN RANDOM FOREST MODEL
# -------------------------------------------------------------
features = ["Temperature", "Humidity", "WindSpeed",
            "PM2.5", "PM10", "NO2", "SO2", "CO", "O3"]

model = RandomForestRegressor(n_estimators=150, random_state=42)
model.fit(df[features], df["AQI"])
df["Predicted_AQI"] = model.predict(df[features])

# -------------------------------------------------------------
# ‚úî SELECT LOCATION
# -------------------------------------------------------------
place = st.selectbox("üìå Select a Delhi Location", df["Place"].unique())
row = df[df["Place"] == place].iloc[0]
aqi = row["Predicted_AQI"]

st.subheader(f"üìç Air Quality Details for **{place}**")

# -------------------------------------------------------------
# ‚úî WEATHER & POLLUTANT VALUES
# -------------------------------------------------------------
st.write("### üå° Weather & Pollutant Levels")
st.dataframe(row[["Temperature", "Humidity", "WindSpeed",
                  "PM2.5", "PM10", "NO2", "SO2", "CO", "O3"]].to_frame())

st.metric("AQI", f"{row['AQI']:.2f}")


# -------------------------------------------------------------
# ‚úî FUNCTION: Best Time to Go Outside
# -------------------------------------------------------------
def best_time(aqi):
    if aqi <= 80:
        return "üü¢ Morning 6 AM ‚Äì 10 AM (Fresh air)"
    elif aqi <= 150:
        return "üü° Evening 5 PM ‚Äì 8 PM"
    elif aqi <= 250:
        return "üü† 9 PM ‚Äì 5 AM (Avoid smog hours)"
    else:
        return "üî¥ Avoid going outside today"

# -------------------------------------------------------------
# ‚úî FUNCTION: Vehicle Recommendation
# -------------------------------------------------------------
def vehicle_advice(aqi):
    if aqi <= 80:
        return "Use **bike/scooter**, it's safe."
    elif aqi <= 150:
        return "Prefer **Metro or EV**."
    else:
        return "Use **public transport** only."

# -------------------------------------------------------------
# ‚≠ê WOW FACTOR ‚Äî AI ALERT SYSTEM FOR SCHOOLS, HOSPITALS, SENIOR CITIZENS
# -------------------------------------------------------------
def school_alert(aqi):
    if aqi <= 150:
        return "üü¢ Schools can operate normally."
    elif aqi <= 250:
        return "üü† Schools should avoid morning assemblies."
    else:
        return "üî¥ Schools advised to shift to **online classes**."

def hospital_alert(aqi):
    if aqi <= 120:
        return "üü¢ Safe for normal patients."
    elif aqi <= 200:
        return "üü° Asthma/COPD patients should limit outdoor movement."
    else:
        return "üî¥ Hospitals should issue **respiratory emergency warnings**."

def senior_alert(aqi):
    if aqi <= 120:
        return "üü¢ Elders (60+) can move outside carefully."
    elif aqi <= 200:
        return "üü° Morning/Evening walks should be avoided."
    else:
        return "üî¥ Seniors should stay indoors; high risk AQI."

# -------------------------------------------------------------
# ‚úî DISPLAY AI RECOMMENDATIONS
# -------------------------------------------------------------
st.subheader("‚è∞ Best Time To Go Outside")
st.success(best_time(aqi))

st.subheader("üöó Vehicle Recommendation")
st.info(vehicle_advice(aqi))

st.subheader("üè´ School Safety Alert")
st.warning(school_alert(aqi))

st.subheader("üè• Hospital & Patient Alert")
st.error(hospital_alert(aqi))

st.subheader("üë¥ Senior Citizen Alert")
st.info(senior_alert(aqi))

# -------------------------------------------------------------
# ‚úî PLOT: Actual vs Predicted AQI
# -------------------------------------------------------------
st.header("üìà Actual vs Predicted AQI Across Delhi")

fig, ax = plt.subplots(figsize=(8,4))
ax.plot(df["Place"], df["AQI"], marker='o', label="Actual AQI", linewidth=2)
ax.plot(df["Place"], df["Predicted_AQI"], marker='o', label="Predicted AQI", linewidth=2)
plt.xticks(rotation=45)
ax.set_ylabel("AQI Level")
ax.legend()
st.pyplot(fig)

st.success("Dashboard Loaded Successfully üöÄ")



# -------------------------------------------------------------
# ‚≠ê WOW FEATURE: AI QUESTION BOX (ASK ANYTHING ABOUT GOING OUTSIDE)
# -------------------------------------------------------------
st.header("ü§ñ Ask AQI Assistant")

user_question = st.text_input("Type your question (Example: 'Should I go outside?' or 'Which vehicle should I use?')")

def answer_question(question, aqi_value):
    question = question.lower()

    # Direct Going Outside Logic
    if "go outside" in question or "outside" in question or "go out" in question:
        if aqi_value <= 80:
            return "üü¢ Yes! Air is clean and safe. You can go outside anytime."
        elif aqi_value <= 150:
            return "üü° You can go outside, but avoid afternoons. Best time is 5 PM ‚Äì 8 PM."
        elif aqi_value <= 250:
            return "üü† Try to avoid going out. If needed, go between 9 PM ‚Äì 5 AM."
        else:
            return "üî¥ No! Air quality is dangerous. Avoid going outside today."

    # Vehicle Advice
    if "vehicle" in question or "car" in question or "bike" in question or "two wheeler" in question:
        if aqi_value <= 80:
            return "üü¢ Use bike/scooter/car ‚Äî everything is safe today."
        elif aqi_value <= 150:
            return "üü° Prefer Metro, EV, or 2-wheelers. Avoid heavy cars."
        else:
            return "üî¥ Avoid 4-wheelers. Use Metro or public transport only."

    # Kids
    if "kid" in question or "children" in question:
        if aqi_value <= 100:
            return "üü¢ Kids can play outside safely."
        elif aqi_value <= 200:
            return "üü° Outdoor time should be limited. No long play sessions."
        else:
            return "üî¥ Kids should stay indoors. Very harmful AQI."

    # Senior Citizens
    if "senior" in question or "old" in question or "elder" in question:
        if aqi_value <= 120:
            return "üü¢ Seniors can go for walks safely."
        elif aqi_value <= 200:
            return "üü° Avoid morning/evening walks. Moderate risk."
        else:
            return "üî¥ Seniors must stay indoors. Very unhealthy AQI."

    # Health Patients
    if "asthma" in question or "heart" in question or "copd" in question or "patient" in question:
        if aqi_value <= 100:
            return "üü¢ Safe for sensitive groups."
        elif aqi_value <= 200:
            return "üü° Asthma/heart patients should avoid outdoor activity."
        else:
            return "üî¥ Danger! Patients must stay indoors."

    # Default Answer
    return "ü§î I didn't understand fully. Try asking: 'Should I go outside?', 'Which vehicle should I use?' or 'Is it safe for kids?'"


if user_question:
    st.subheader("üí¨ Assistant Answer:")
    st.info(answer_question(user_question, aqi))

