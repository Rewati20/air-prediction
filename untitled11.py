# -*- coding: utf-8 -*-
"""Untitled11.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zmnE2PDAUQ1qtohTYWvdeZ2GUMfMfSPb
"""

import streamlit as st
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor

# --------------------------------------------------
# PAGE SETTINGS
# --------------------------------------------------
st.set_page_config(page_title="Delhi Air Quality Predictor", layout="wide")

st.title("üåç Delhi Air Quality Prediction System")
st.write("Choose an area in Delhi to see predicted pollution levels and the safest time to go outside.")

# --------------------------------------------------
# INTERNAL MINI DATASET (created from your dataset structure)
# --------------------------------------------------
data = {
    "Place": [
        "Connaught Place", "Rohini", "Dwarka", "Saket",
        "Karol Bagh", "Lajpat Nagar", "Punjabi Bagh",
        "Janakpuri", "Chanakyapuri", "Mayur Vihar"
    ],
    "Latitude": [28.63, 28.75, 28.57, 28.52, 28.65, 28.57, 28.67, 28.62, 28.59, 28.60],
    "Longitude": [77.21, 77.11, 77.03, 77.22, 77.18, 77.24, 77.12, 77.09, 77.18, 77.30],

    "Temperature": np.random.randint(15, 40, 10),
    "Humidity": np.random.randint(20, 90, 10),
    "WindSpeed": np.random.uniform(0.5, 10, 10),

    "PM2.5": np.random.randint(50, 300, 10),
    "PM10": np.random.randint(80, 350, 10),
    "NO2": np.random.randint(20, 120, 10),
    "SO2": np.random.randint(5, 70, 10),
    "CO": np.random.uniform(0.4, 2.0, 10),
    "O3": np.random.randint(10, 70, 10),
}

df = pd.DataFrame(data)
df["AQI"] = (0.4 * df["PM2.5"] +
             0.3 * df["PM10"] +
             0.1 * df["NO2"] +
             0.1 * df["SO2"] +
             0.05 * df["CO"] +
             0.05 * df["O3"])

# --------------------------------------------------
# TRAIN RANDOM FOREST ON INTERNAL DATA
# --------------------------------------------------
features = ["Temperature", "Humidity", "WindSpeed", "PM2.5", "PM10", "NO2", "SO2", "CO", "O3"]
X = df[features]
y = df["AQI"]

model = RandomForestRegressor(n_estimators=150, random_state=42)
model.fit(X, y)

# --------------------------------------------------
# USER SELECTS DELHI AREA
# --------------------------------------------------
place = st.selectbox("üìå Select a Delhi Location", df["Place"].tolist())

row = df[df["Place"] == place].iloc[0]

st.subheader(f"üìç Air Quality Report for **{place}**")

# --------------------------------------------------
# PREDICT AQI FOR SELECTED PLACE
# --------------------------------------------------
input_data = row[features].values.reshape(1, -1)
predicted_aqi = model.predict(input_data)[0]

st.metric("Predicted AQI", f"{predicted_aqi:.2f}")

# --------------------------------------------------
# SHOW ALL POLLUTANT VALUES
# --------------------------------------------------
st.write("### üå° Weather & Pollution Data")
st.write(row[["Temperature", "Humidity", "WindSpeed",
              "PM2.5", "PM10", "NO2", "SO2", "CO", "O3"]])

# --------------------------------------------------
# BEST TIME TO GO OUTSIDE (AI RULES)
# --------------------------------------------------
st.write("### ‚è∞ Best Time to Go Outside")

if predicted_aqi <= 80:
    best_time = "Morning (6 AM ‚Äì 10 AM)"
    note = "Air is fresh and safe."
elif predicted_aqi <= 150:
    best_time = "Evening (5 PM ‚Äì 8 PM)"
    note = "Air quality is moderate."
elif predicted_aqi <= 250:
    best_time = "Avoid peak hours ‚Äî safest between 9 PM ‚Äì 5 AM"
    note = "Sensitive groups should wear masks."
else:
    best_time = "Avoid going outside today"
    note = "Air is hazardous!"

st.success(f"Recommended Time: **{best_time}**")
st.write(f"üí° Note: {note}")

# --------------------------------------------------
# HEALTH SUGGESTION
# --------------------------------------------------
st.write("### üíö Health Recommendation")
if predicted_aqi < 100:
    st.info("Good air quality. Normal activities are safe.")
elif predicted_aqi < 200:
    st.warning("Wear a mask if you have asthma or allergies.")
else:
    st.error("Avoid outdoor exercise. Keep windows closed.")